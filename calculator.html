<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator — Numpad "." → 000</title>
  <style>
    :root{--bg:#0f1724;--panel:#0b1220;--accent:#1e88e5;--muted:#94a3b8;--btn:#0f1724}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Nanum Gothic',sans-serif;background:var(--bg);display:flex;align-items:center;justify-content:center}
    .calc{width:360px;background:linear-gradient(180deg,#071124 0%, #071827 100%);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,.6)}
    .display{height:72px;background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;color:#e6eef8;font-size:24px;word-break:break-all}
    .sub{font-size:12px;color:var(--muted);opacity:.9}
    .keys{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px}
    button{height:56px;border-radius:8px;border:0;font-size:18px;background:rgba(255,255,255,0.03);color:#e6eef8;cursor:pointer}
    button.op{background:linear-gradient(180deg,#152e46,#0f2a3f);color:#fff}
    button.wide{grid-column:span 2}
    .kbd-hint{font-size:12px;color:var(--muted);margin-top:10px}
  </style>
</head>
<body>
  <div class="calc" role="application" aria-label="Calculator with numpad-dot mapping">
    <div class="display" id="display" aria-live="polite">
      <div class="sub" id="expression">0</div>
      <div id="result">0</div>
    </div>

    <div class="keys" id="keys">
      <button data-action="clear">C</button>
      <button data-action="negate">+/-</button>
      <button data-action="percent">%</button>
      <button class="op" data-action="/">÷</button>

      <button data-digit="7">7</button>
      <button data-digit="8">8</button>
      <button data-digit="9">9</button>
      <button class="op" data-action="*">×</button>

      <button data-digit="4">4</button>
      <button data-digit="5">5</button>
      <button data-digit="6">6</button>
      <button class="op" data-action="-">−</button>

      <button data-digit="1">1</button>
      <button data-digit="2">2</button>
      <button data-digit="3">3</button>
      <button class="op" data-action="+">+</button>

      <button data-digit="0" class="wide">0</button>
      <button data-dot="ui">.</button>
      <button class="op" data-action="=">=</button>
    </div>

    <div class="kbd-hint">키보드 사용: 숫자키패드의 <strong>.</strong> 키를 누르면 <strong>000</strong> 입력됩니다. 일반 키보드의 <strong>.</strong>는 소수점 입력입니다.</div>
  </div>

  <script>
    // Simple calculator implementation with explicit handling of NumpadDecimal
    (function(){
      const expressionEl = document.getElementById('expression');
      const resultEl = document.getElementById('result');
      const keys = document.getElementById('keys');

      let expr = '';
      let lastIsEval = false;

      function render(){
        expressionEl.textContent = expr || '0';
        resultEl.textContent = '';
      }

      function safeEval(input){
        // Very simple safe-ish evaluation: allow digits, operators, dot, parentheses, percent
        if(!/^[0-9+\-*/().%\s]*$/.test(input)) return 'Error';
        try{
          // Handle percent: convert 'n%' -> '(n/100)'
          const transformed = input.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
          // eslint-disable-next-line no-new-func
          const v = Function('return '+transformed)();
          if(Number.isFinite(v)) return v;
          return 'Error';
        }catch(e){
          return 'Error';
        }
      }

      keys.addEventListener('click', e=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        if(btn.dataset.digit) appendDigit(btn.dataset.digit);
        else if(btn.dataset.dot) appendDot();
        else if(btn.dataset.action) handleAction(btn.dataset.action);
        render();
      });

      function appendDigit(d){
        if(lastIsEval){ expr = ''; lastIsEval = false; }
        expr += d;
      }

      function appendDot(){
        // UI button behaves as decimal point (regular dot)
        if(lastIsEval){ expr = ''; lastIsEval = false; }
        // Prevent multiple dots in the current number token
        const parts = expr.split(/[^0-9.]/);
        const current = parts[parts.length-1] || '';
        if(current.includes('.')) return;
        if(current === '') expr += '0';
        expr += '.';
      }

      function handleAction(act){
        if(act === 'clear'){ expr = ''; lastIsEval = false; }
        else if(act === 'negate'){
          // Try to negate the last number
          expr = expr.replace(/(\d+(?:\.\d+)?)$/,(m)=>{ return '(-'+m+')'});
        }
        else if(act === 'percent'){
          expr += '%';
        }
        else if(act === '='){
          const res = safeEval(expr);
          resultEl.textContent = res;
          lastIsEval = true;
        }
        else{
          // + - * /
          if(lastIsEval){ // continue with result
            const prev = resultEl.textContent;
            if(prev && prev !== 'Error') expr = String(prev);
            lastIsEval = false;
          }
          // avoid two operators in a row
          if(/[^0-9.)]$/.test(expr)) expr = expr.slice(0,-1);
          expr += act;
        }
      }

      // Keyboard support. We must detect the NUMPAD decimal key ONLY.
      // KeyboardEvent.code === 'NumpadDecimal' on most browsers for numeric keypad '.'
      window.addEventListener('keydown', (ev)=>{
        // Ignore if focus in an input (none in this UI), but keep behaviour consistent
        // Map digits
        if(ev.code && ev.code.startsWith('Numpad') && ev.code.length <= 12){
          // Numpad0..Numpad9
          if(/^Numpad[0-9]$/.test(ev.code)){
            const d = ev.code.slice(-1);
            appendDigit(d);
            render();
            ev.preventDefault();
            return;
          }
          if(ev.code === 'NumpadDecimal'){
            // IMPORTANT: numeric keypad '.' should insert '000' (the user's requirement)
            if(lastIsEval){ expr = ''; lastIsEval = false; }
            expr += '000';
            render();
            ev.preventDefault();
            return;
          }
          // NumpadAdd/Subtract/Multiply/Divide/Enter
          if(ev.code === 'NumpadAdd'){ handleAction('+'); render(); ev.preventDefault(); return; }
          if(ev.code === 'NumpadSubtract'){ handleAction('-'); render(); ev.preventDefault(); return; }
          if(ev.code === 'NumpadMultiply'){ handleAction('*'); render(); ev.preventDefault(); return; }
          if(ev.code === 'NumpadDivide'){ handleAction('/'); render(); ev.preventDefault(); return; }
          if(ev.code === 'NumpadEnter'){ handleAction('='); render(); ev.preventDefault(); return; }
        }

        // Non-numpad keyboard handling: allow digits, Enter, Backspace, regular dot
        if(ev.key >= '0' && ev.key <= '9'){
          appendDigit(ev.key); render(); ev.preventDefault(); return;
        }
        if(ev.key === '.'){
          // Regular '.' (not numeric keypad) should behave as a decimal point
          appendDot(); render(); ev.preventDefault(); return;
        }
        if(ev.key === 'Enter'){
          handleAction('='); render(); ev.preventDefault(); return;
        }
        if(ev.key === 'Backspace'){
          expr = expr.slice(0,-1); render(); ev.preventDefault(); return;
        }
        if(ev.key === '+'||ev.key === '-'||ev.key === '*'||ev.key === '/'){
          handleAction(ev.key); render(); ev.preventDefault(); return;
        }
      });

      // initial render
      render();

      // Accessibility: announce when NumpadDecimal is used
      window.addEventListener('keydown', (ev)=>{
        if(ev.code === 'NumpadDecimal'){
          // small visual cue in the subdisplay
          const old = expressionEl.textContent;
          expressionEl.textContent = expr + ' \u00A0';
          setTimeout(()=>{ expressionEl.textContent = expr || '0'; }, 200);
        }
      });

    })();
  </script>
</body>
</html>
